# Sveltia CMS Configuration for STAC Metadata Authoring
# Documentation: https://github.com/sveltia/sveltia-cms

# Backend Configuration
backend:
  name: github
  repo: walkthru-earth/stac-cms-template
  branch: main
  base_url: https://opensensor-auth.walkthru-earth.workers.dev
  auth_endpoint: /auth

# Optional: Use the test-repo backend for local development
# backend:
#   name: test-repo

# Site Configuration
site_url: https://walkthru.earth/stac-cms-template

# Publishing Mode
publish_mode: editorial_workflow  # Enables draft/review workflow

# Media Configuration
media_folder: assets
public_folder: /stac-cms-template/assets

# Collections Configuration
collections:
  # ============================================
  # STAC Items
  # ============================================
  - name: stac-items
    label: 'STAC Items'
    label_singular: 'STAC Item'
    description: 'Geospatial asset metadata following the STAC Item specification'
    folder: items
    format: stac-json
    extension: json
    create: true
    slug: '{{id}}'
    identifier_field: id
    summary: '{{id}} - {{properties.title}} ({{properties.datetime}})'

    fields:
      # Core GeoJSON/STAC fields
      - label: 'Type'
        name: 'type'
        widget: 'hidden'
        default: 'Feature'

      - label: 'STAC Version'
        name: 'stac_version'
        widget: 'hidden'
        default: '1.1.0'

      - label: 'STAC Extensions'
        name: 'stac_extensions'
        widget: 'list'
        required: false
        collapsed: true
        hint: 'Optional: URLs to STAC extension JSON schemas'
        field:
          label: 'Extension URL'
          name: 'extension'
          widget: 'string'

      - label: 'ID'
        name: 'id'
        widget: 'string'
        required: true
        hint: 'Unique identifier for this item'
        pattern: ['^[a-zA-Z0-9_-]+$', 'Must contain only alphanumeric characters, hyphens, and underscores']

      # Geometry - Using Sveltia's map widget with Leaflet
      - label: 'Geometry'
        name: 'geometry'
        widget: 'map'
        required: true
        type: 'Polygon'  # Options: Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon
        decimals: 6
        hint: 'Draw the footprint of your geospatial asset on the map'

      # Bounding Box
      - label: 'Bounding Box'
        name: 'bbox'
        widget: 'list'
        required: false
        min: 4
        max: 6
        hint: '✨ AUTO-CALCULATED from geometry! You can override manually if needed. Format: [minLon, minLat, maxLon, maxLat]'
        summary: '[{{fields.coordinate}}]'
        field:
          label: 'Coordinate'
          name: 'coordinate'
          widget: 'number'
          value_type: 'float'
          step: 0.000001
          min: -180
          max: 180

      # Properties Object
      - label: 'Properties'
        name: 'properties'
        widget: 'object'
        required: true
        collapsed: false
        fields:
          - label: 'Date & Time'
            name: 'datetime'
            widget: 'datetime'
            required: true
            format: 'YYYY-MM-DDTHH:mm:ssZ'
            hint: 'Acquisition or creation date/time in UTC'

          - label: 'Title'
            name: 'title'
            widget: 'string'
            required: false
            hint: 'Human-readable title'

          - label: 'Description'
            name: 'description'
            widget: 'text'
            required: false
            hint: 'Detailed description of the asset'

          - label: 'Start Date/Time'
            name: 'start_datetime'
            widget: 'datetime'
            required: false
            format: 'YYYY-MM-DDTHH:mm:ssZ'
            hint: 'For time ranges, the start datetime'

          - label: 'End Date/Time'
            name: 'end_datetime'
            widget: 'datetime'
            required: false
            format: 'YYYY-MM-DDTHH:mm:ssZ'
            hint: 'For time ranges, the end datetime'

          - label: 'Created Date'
            name: 'created'
            widget: 'datetime'
            required: false
            format: 'YYYY-MM-DDTHH:mm:ssZ'
            hint: 'Creation date of the metadata'

          - label: 'Updated Date'
            name: 'updated'
            widget: 'datetime'
            required: false
            format: 'YYYY-MM-DDTHH:mm:ssZ'
            hint: 'Last update date of the metadata'

      # ============================================
      # LINKS - STAC Navigation Structure
      # ============================================

      - label: 'Links'
        name: 'links'
        widget: 'list'
        required: true
        collapsed: false
        summary: '{{fields.rel}}: {{fields.title}} → {{fields.href}}'
        hint: 'STAC link relationships. STRONGLY RECOMMENDED: Include self, root, parent, collection links for proper navigation.'
        fields:
          - label: 'Relation Type'
            name: 'rel'
            widget: 'select'
            required: true
            options:
              - { label: 'Self (this item URL)', value: 'self' }
              - { label: 'Root (main catalog)', value: 'root' }
              - { label: 'Parent (parent catalog/collection)', value: 'parent' }
              - { label: 'Collection (parent collection - REQUIRED)', value: 'collection' }
              - { label: 'Related Item', value: 'item' }
              - { label: 'Derived From', value: 'derived_from' }
              - { label: 'License', value: 'license' }
            hint: '✅ AUTOMATIC: "Collection" is auto-set by relation widget above. Recommended: Add self, root, parent links for navigation.'

          - label: 'URL (href)'
            name: 'href'
            widget: 'string'
            required: true
            hint: 'Relative path examples: ../catalog.json (root), ../collections/my-collection.json (collection), or absolute URL'

          - label: 'Media Type'
            name: 'type'
            widget: 'select'
            default: 'application/json'
            required: false
            options:
              - { label: 'application/json (Catalog/Collection)', value: 'application/json' }
              - { label: 'application/geo+json (Item)', value: 'application/geo+json' }
              - { label: 'text/html', value: 'text/html' }

          - label: 'Title'
            name: 'title'
            widget: 'string'
            required: false
            hint: 'Human-readable title - should match the title of the linked entity'

      # Assets Object (using key-value widget for better UX)
      - label: 'Assets'
        name: 'assets'
        widget: 'object'
        required: true
        collapsed: false
        hint: 'Downloadable assets (images, data files, etc.)'
        fields:
          - label: 'Visual Asset'
            name: 'visual'
            widget: 'object'
            required: false
            fields:
              - label: 'Image'
                name: 'href'
                widget: 'image'
                choose_url: true
                required: true
                hint: 'Upload an image or enter a URL'
                media_folder: '/assets/visual'
                public_folder: '/stac-cms-template/assets/visual'
              - { label: 'Title', name: 'title', widget: 'string', required: false }
              - { label: 'Description', name: 'description', widget: 'text', required: false }
              - { label: 'Media Type', name: 'type', widget: 'string', default: 'image/tiff', required: false }
              - label: 'Roles'
                name: 'roles'
                widget: 'list'
                required: false
                min: 1
                default: ['visual']
                field: { label: 'Role', name: 'role', widget: 'string' }

          - label: 'Thumbnail'
            name: 'thumbnail'
            widget: 'object'
            required: false
            fields:
              - label: 'Image'
                name: 'href'
                widget: 'image'
                choose_url: true
                required: true
                hint: 'Upload an image or enter a URL'
                media_folder: '/assets/thumbnails'
                public_folder: '/stac-cms-template/assets/thumbnails'
              - { label: 'Title', name: 'title', widget: 'string', default: 'Thumbnail', required: false }
              - { label: 'Description', name: 'description', widget: 'text', required: false }
              - { label: 'Media Type', name: 'type', widget: 'string', default: 'image/jpeg', required: false }
              - label: 'Roles'
                name: 'roles'
                widget: 'list'
                required: false
                min: 1
                default: ['thumbnail']
                field: { label: 'Role', name: 'role', widget: 'string' }

          - label: 'Metadata'
            name: 'metadata'
            widget: 'object'
            required: false
            fields:
              - { label: 'URL', name: 'href', widget: 'string', required: true }
              - { label: 'Title', name: 'title', widget: 'string', required: false }
              - { label: 'Description', name: 'description', widget: 'text', required: false }
              - { label: 'Media Type', name: 'type', widget: 'string', default: 'application/xml', required: false }
              - label: 'Roles'
                name: 'roles'
                widget: 'list'
                required: false
                min: 1
                default: ['metadata']
                field: { label: 'Role', name: 'role', widget: 'string' }

      # ============================================
      # COLLECTION REFERENCE - AUTOMATIC RELATIONSHIP
      # ============================================

      - label: 'Collection'
        name: 'collection'
        widget: 'relation'
        collection: 'stac-collections'
        search_fields: ['id', 'title']
        value_field: 'id'
        display_fields: ['title']
        required: false
        hint: '✅ AUTOMATIC: Select parent collection from dropdown. Stores collection ID and auto-creates collection link. ⚠️ MANUAL STEP REQUIRED: You must also add this item as an "item" link in the parent collection!'

  # ============================================
  # STAC Collections
  # ============================================
  - name: stac-collections
    label: 'STAC Collections'
    label_singular: 'STAC Collection'
    description: 'Groups of STAC Items with shared properties'
    folder: collections
    format: json
    extension: json
    create: true
    slug: '{{id}}'
    identifier_field: id
    summary: '{{id}} - {{title}}'

    fields:
      - label: 'Type'
        name: 'type'
        widget: 'hidden'
        default: 'Collection'

      - label: 'STAC Version'
        name: 'stac_version'
        widget: 'hidden'
        default: '1.1.0'

      - label: 'STAC Extensions'
        name: 'stac_extensions'
        widget: 'list'
        required: false
        collapsed: true
        field:
          label: 'Extension URL'
          name: 'extension'
          widget: 'string'

      - label: 'ID'
        name: 'id'
        widget: 'string'
        required: true
        hint: 'Unique identifier for this collection'
        pattern: ['^[a-zA-Z0-9_-]+$', 'Must contain only alphanumeric characters, hyphens, and underscores']

      - label: 'Title'
        name: 'title'
        widget: 'string'
        required: true

      - label: 'Description'
        name: 'description'
        widget: 'text'
        required: true

      - label: 'Keywords'
        name: 'keywords'
        widget: 'list'
        required: false
        field:
          label: 'Keyword'
          name: 'keyword'
          widget: 'string'

      - label: 'License'
        name: 'license'
        widget: 'select'
        required: true
        options:
          - { label: 'Creative Commons Attribution 4.0', value: 'CC-BY-4.0' }
          - { label: 'Creative Commons Zero (Public Domain)', value: 'CC0-1.0' }
          - { label: 'MIT License', value: 'MIT' }
          - { label: 'Apache 2.0', value: 'Apache-2.0' }
          - { label: 'Proprietary', value: 'proprietary' }
          - { label: 'Various', value: 'various' }
        default: 'CC-BY-4.0'

      # Extent
      - label: 'Extent'
        name: 'extent'
        widget: 'object'
        required: true
        fields:
          - label: 'Spatial Extent'
            name: 'spatial'
            widget: 'object'
            required: true
            fields:
              - label: 'Bounding Boxes'
                name: 'bbox'
                widget: 'list'
                required: true
                hint: 'One or more bounding boxes'
                field:
                  label: 'Bounding Box'
                  name: 'bounds'
                  widget: 'list'
                  hint: '[minLon, minLat, maxLon, maxLat]'
                  field:
                    label: 'Coordinate'
                    name: 'coord'
                    widget: 'number'
                    value_type: 'float'

          - label: 'Temporal Extent'
            name: 'temporal'
            widget: 'object'
            required: true
            fields:
              - label: 'Intervals'
                name: 'interval'
                widget: 'list'
                required: true
                hint: 'One or more time intervals'
                field:
                  label: 'Time Range'
                  name: 'range'
                  widget: 'list'
                  hint: '[start_datetime, end_datetime] - use null for open-ended'
                  field:
                    label: 'DateTime'
                    name: 'dt'
                    widget: 'string'
                    required: false

      # Providers
      - label: 'Providers'
        name: 'providers'
        widget: 'list'
        required: false
        summary: '{{fields.name}}'
        fields:
          - { label: 'Name', name: 'name', widget: 'string', required: true }
          - { label: 'Description', name: 'description', widget: 'text', required: false }
          - { label: 'URL', name: 'url', widget: 'string', required: false }
          - label: 'Roles'
            name: 'roles'
            widget: 'select'
            multiple: true
            options:
              - { label: 'Producer', value: 'producer' }
              - { label: 'Licensor', value: 'licensor' }
              - { label: 'Processor', value: 'processor' }
              - { label: 'Host', value: 'host' }

      # ============================================
      # RELATIONSHIP HELPERS
      # These fields help manage STAC relationships
      # ============================================

      - label: 'Parent Catalog (Quick Add)'
        name: '_parent_catalog_helper'
        widget: 'relation'
        collection: 'stac-catalogs'
        search_fields: ['id', 'title']
        value_field: 'id'
        display_fields: ['title', 'id']
        required: false
        hint: "⚠️ MANUAL LINK REQUIRED: Select the parent catalog, then add a 'parent' link below with href: ../catalog/[catalog-id].json. Remember to also add this collection as a 'child' link in the parent catalog!"

      - label: 'Items in This Collection (Quick Reference)'
        name: '_items_helper'
        widget: 'relation'
        collection: 'stac-items'
        search_fields: ['id', 'properties.title']
        value_field: 'id'
        display_fields: ['properties.title', 'id']
        multiple: true
        required: false
        filters:
          - field: 'collection'
            values: ['{{id}}']
        hint: "⚠️ MANUAL LINKS REQUIRED: These items reference this collection. You must manually add 'item' links below for each one with href: ../items/[item-id].json"

      # ============================================
      # LINKS - STAC Navigation Structure
      # ============================================

      - label: 'Links'
        name: 'links'
        widget: 'list'
        required: true
        summary: '{{fields.rel}}: {{fields.title}} → {{fields.href}}'
        hint: 'STAC link relationships. STRONGLY RECOMMENDED: Include self, root, parent links. REQUIRED: Add "item" link for each item in this collection (see helper above).'
        fields:
          - label: 'Relation Type'
            name: 'rel'
            widget: 'select'
            required: true
            options:
              - { label: 'Self (this collection URL)', value: 'self' }
              - { label: 'Root (main catalog)', value: 'root' }
              - { label: 'Parent (parent catalog)', value: 'parent' }
              - { label: 'Item (item in this collection)', value: 'item' }
              - { label: 'Child (sub-collection - rare)', value: 'child' }
              - { label: 'License', value: 'license' }
            hint: 'self = this collection, root = main catalog, parent = parent catalog/collection, item = items belonging to this collection'

          - label: 'URL (href)'
            name: 'href'
            widget: 'string'
            required: true
            hint: 'Relative path examples: ../catalog.json (parent), ../items/my-item.json (item), or absolute URL'

          - label: 'Media Type'
            name: 'type'
            widget: 'select'
            default: 'application/json'
            options:
              - { label: 'application/json (Catalog/Collection)', value: 'application/json' }
              - { label: 'application/geo+json (Item)', value: 'application/geo+json' }
              - { label: 'text/html', value: 'text/html' }

          - label: 'Title'
            name: 'title'
            widget: 'string'
            required: false
            hint: 'Human-readable title - should match the title of the linked entity'

      # Summaries (optional)
      - label: 'Summaries'
        name: 'summaries'
        widget: 'code'
        required: false
        default_language: 'json'
        allow_language_selection: false
        hint: 'Summary statistics as JSON object (e.g., {"gsd": {"minimum": 0.5, "maximum": 1.0}})'

  # ============================================
  # STAC Catalogs
  # ============================================
  - name: stac-catalogs
    label: 'STAC Catalogs'
    label_singular: 'STAC Catalog'
    description: 'Top-level organizational structure for STAC'
    folder: catalog
    format: json
    extension: json
    create: true
    slug: '{{id}}'
    identifier_field: id
    summary: '{{id}} - {{title}}'

    fields:
      - label: 'Type'
        name: 'type'
        widget: 'hidden'
        default: 'Catalog'

      - label: 'STAC Version'
        name: 'stac_version'
        widget: 'hidden'
        default: '1.1.0'

      - label: 'ID'
        name: 'id'
        widget: 'string'
        required: true
        pattern: ['^[a-zA-Z0-9_-]+$', 'Must contain only alphanumeric characters, hyphens, and underscores']

      - label: 'Title'
        name: 'title'
        widget: 'string'
        required: true

      - label: 'Description'
        name: 'description'
        widget: 'text'
        required: true

      # ============================================
      # RELATIONSHIP HELPERS
      # These fields help manage STAC relationships
      # ============================================

      - label: 'Child Collections (Quick Add)'
        name: '_child_collections_helper'
        widget: 'relation'
        collection: 'stac-collections'
        search_fields: ['id', 'title']
        value_field: 'id'
        display_fields: ['title', 'id']
        multiple: true
        required: false
        hint: "Select collections to link as children. This helps you quickly add child links below. Note: This is a helper field - actual links are managed in the 'Links' section below."

      - label: 'Child Catalogs (Quick Add)'
        name: '_child_catalogs_helper'
        widget: 'relation'
        collection: 'stac-catalogs'
        search_fields: ['id', 'title']
        value_field: 'id'
        display_fields: ['title', 'id']
        multiple: true
        required: false
        hint: "Select sub-catalogs to link as children. This helps you quickly add child links below. Note: This is a helper field - actual links are managed in the 'Links' section below."

      - label: 'Parent Catalog (Optional)'
        name: '_parent_catalog_helper'
        widget: 'relation'
        collection: 'stac-catalogs'
        search_fields: ['id', 'title']
        value_field: 'id'
        display_fields: ['title', 'id']
        required: false
        hint: "If this is a sub-catalog, select its parent catalog. Note: This is a helper field - you must also add a 'parent' link below."

      # ============================================
      # LINKS - STAC Navigation Structure
      # ============================================

      - label: 'Links'
        name: 'links'
        widget: 'list'
        required: true
        summary: '{{fields.rel}}: {{fields.title}} → {{fields.href}}'
        hint: 'STAC link relationships for navigation. STRONGLY RECOMMENDED: Include self, root links. Add child links for collections/sub-catalogs, parent link if this is a sub-catalog.'
        fields:
          - label: 'Relation Type'
            name: 'rel'
            widget: 'select'
            required: true
            options:
              - { label: 'Self (this catalog URL)', value: 'self' }
              - { label: 'Root (main catalog)', value: 'root' }
              - { label: 'Parent (parent catalog)', value: 'parent' }
              - { label: 'Child (sub-catalog or collection)', value: 'child' }
              - { label: 'Item (direct item link - rare)', value: 'item' }
              - { label: 'License', value: 'license' }
            hint: 'self = this catalog, root = main catalog, parent = parent catalog, child = sub-catalog or collection'

          - label: 'URL (href)'
            name: 'href'
            widget: 'string'
            required: true
            hint: 'Use relative paths (e.g., ./catalog.json, ../collections/my-collection.json) or absolute URLs (https://...)'

          - label: 'Media Type'
            name: 'type'
            widget: 'select'
            default: 'application/json'
            options:
              - { label: 'application/json (Catalog/Collection)', value: 'application/json' }
              - { label: 'application/geo+json (Item)', value: 'application/geo+json' }
              - { label: 'text/html', value: 'text/html' }
            hint: 'Use application/json for Catalogs and Collections, application/geo+json for Items'

          - label: 'Title'
            name: 'title'
            widget: 'string'
            required: false
            hint: 'Human-readable title - should match the title of the linked entity'
